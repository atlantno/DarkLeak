<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DarkLeak - Анонимная сеть сливов</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- Используем совместимую версию Firebase (8.x вместо 9.x) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { 
            background: linear-gradient(180deg, #1C2526 0%, #0A0A0A 100%); 
            color: #D3D3D3; 
            min-height: 100vh; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 30px; 
            background: rgba(0, 0, 0, 0.5); 
            border-radius: 10px; 
            margin-bottom: 20px; 
            width: 100%; 
            max-width: 1200px; 
        }
        .logo { font-size: 24px; font-weight: 700; color: #FFFFFF; }
        .logo i { color: #E63946; margin-right: 10px; }
        .logo a { color: #FFFFFF; text-decoration: none; }
        nav a { color: #D3D3D3; text-decoration: none; margin: 0 15px; font-weight: 500; transition: color 0.3s ease; }
        nav a:hover { color: #E63946; }
        .auth-buttons a { color: #E63946; text-decoration: none; margin-left: 15px; font-weight: 500; cursor: pointer; transition: color 0.3s ease; }
        .auth-buttons a:hover { color: #FFFFFF; }
        .search-section { 
            text-align: center; 
            margin: 30px 0; 
            width: 100%; 
            max-width: 1200px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 10px; 
        }
        .search-section input { 
            padding: 10px 20px; 
            width: 100%; 
            max-width: 300px; 
            border: none; 
            border-radius: 20px; 
            background: #2A2F30; 
            color: #D3D3D3; 
            font-size: 16px; 
            outline: none; 
        }
        .search-section button { 
            padding: 10px 20px; 
            border: none; 
            border-radius: 20px; 
            background: #E63946; 
            color: #FFFFFF; 
            font-size: 16px; 
            cursor: pointer; 
            transition: transform 0.2s ease, background 0.3s ease; 
        }
        .search-section button:hover { background: #C5303B; transform: translateY(-2px); }
        .table-section { max-width: 1200px; margin: 0 auto; width: 100%; }
        .table-section h2 { color: #FFFFFF; margin-bottom: 10px; font-size: 20px; }
        .pinned-section { margin-bottom: 40px; }
        table { width: 100%; border-collapse: collapse; background: rgba(0, 0, 0, 0.5); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #2A2F30; }
        th { background: #2A2F30; color: #FFFFFF; font-weight: 700; }
        td { color: #D3D3D3; cursor: pointer; }
        tr:hover { background: rgba(230, 57, 70, 0.1); }
        .pinned { background: rgba(230, 57, 70, 0.2); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: linear-gradient(145deg, #1C2526 0%, #0A0A0A 100%); padding: 30px; border-radius: 15px; width: 600px; max-height: 80vh; overflow-y: auto; color: #D3D3D3; position: relative; box-shadow: 0 10px 30px rgba(230, 57, 70, 0.3); border: 1px solid #E63946; animation: slideIn 0.3s ease-out; text-align: center; }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-content h2 { color: #FFFFFF; font-size: 24px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        .modal-content p { line-height: 1.6; margin-bottom: 15px; white-space: pre-wrap; text-align: center; }
        .modal-content ul { margin: 20px 0; padding-left: 0; list-style: none; text-align: center; }
        .modal-content ul li { margin-bottom: 10px; line-height: 1.6; text-align: center; }
        .modal-content ul li strong { color: #E63946; }
        #loginModal .modal-content, #registerModal .modal-content, #addPostModal .modal-content, #deleteModal .modal-content { width: 400px; }
        .modal-content form { display: flex; flex-direction: column; gap: 15px; text-align: center; }
        .modal-content .password-container { position: relative; }
        .modal-content input, .modal-content select, .modal-content textarea { padding: 12px 40px 12px 20px; border: none; border-radius: 10px; background: #2A2F30; color: #D3D3D3; font-size: 16px; outline: none; transition: border-color 0.3s ease; text-align: center; width: 100%; }
        .modal-content textarea { height: 100px; resize: none; }
        .modal-content input:focus, .modal-content select:focus, .modal-content textarea:focus { border: 2px solid #E63946; }
        .toggle-password { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #E63946; cursor: pointer; font-size: 16px; }
        #loginForm button, #registerForm button, #addPostForm button { padding: 8px 15px; border: none; border-radius: 10px; background: #E63946; color: #FFFFFF; font-size: 16px; cursor: pointer; transition: background 0.3s ease, transform 0.2s ease; width: 180px; margin: 0 auto; }
        #loginForm button:hover, #registerForm button:hover, #addPostForm button:hover { background: #C5303B; transform: translateY(-2px); }
        .error { color: #E63946; font-size: 14px; margin-top: 5px; display: none; text-align: center; }
        .modal-content::-webkit-scrollbar { width: 10px; }
        .modal-content::-webkit-scrollbar-track { background: #0A0A0A; border-radius: 5px; }
        .modal-content::-webkit-scrollbar-thumb { background: #E63946; border-radius: 5px; }
        .modal-content::-webkit-scrollbar-thumb:hover { background: #C5303B; }
        .close-btn { position: absolute; top: 15px; right: 15px; font-size: 24px; color: #E63946; cursor: pointer; transition: color 0.3s ease, transform 0.3s ease; }
        .close-btn:hover { color: #FFFFFF; transform: rotate(90deg); }
        footer { text-align: center; padding: 20px; margin-top: auto; color: #888; width: 100%; max-width: 1200px; }
        footer a { color: #E63946; text-decoration: none; }
        footer a:hover { color: #FFFFFF; }
        .search-results { max-width: 1200px; margin: 0 auto; display: none; width: 100%; }
        .search-results h2 { color: #FFFFFF; margin-bottom: 10px; font-size: 20px; }
        .darkleak-link { color: #FFFFFF; text-decoration: none; cursor: pointer; }
        .darkleak-link:hover { color: #E63946; }
        .delete-btn { 
            color: #E63946; 
            cursor: pointer; 
            font-size: 16px; 
            margin-left: 10px; 
            transition: color 0.3s ease; 
        }
        .delete-btn:hover { color: #FFFFFF; }
        #deleteModal .modal-content { width: 400px; text-align: center; }
        #deleteModal .modal-content .confirm-buttons { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            margin-top: 20px; 
        }
        #deleteModal .modal-content button { 
            padding: 8px 20px; 
            border: none; 
            border-radius: 10px; 
            font-size: 16px; 
            cursor: pointer; 
            transition: background 0.3s ease, transform 0.2s ease; 
        }
        #deleteModal .modal-content .confirm-btn { 
            background: #E63946; 
            color: #FFFFFF; 
        }
        #deleteModal .modal-content .cancel-btn { 
            background: #2A2F30; 
            color: #D3D3D3; 
        }
        #deleteModal .modal-content .confirm-btn:hover { 
            background: #C5303B; 
            transform: translateY(-2px); 
        }
        #deleteModal .modal-content .cancel-btn:hover { 
            background: #3A4041; 
            transform: translateY(-2px); 
        }
    </style>
</head>
<body>
    <header>
        <div class="logo"><i class="fas fa-skull"></i> <a href="#" class="darkleak-link" onclick="renderMainPage(); return false;">DarkLeak</a></div>
        <nav>
            <a href="#">Главная</a>
            <a href="#">Добавить слив</a>
            <a href="#">Поиск</a>
            <a href="#">Telegram</a>
        </nav>
        <div class="auth-buttons" id="authButtons">
            <a href="#" onclick="openLoginModal(event)">Вход</a>
            <a href="#" onclick="openRegisterModal(event)">Регистрация</a>
        </div>
    </header>

    <div class="search-section">
        <input type="text" placeholder="Поиск по сливам..." id="searchInput">
        <button id="searchButton">Искать</button>
        <button id="addPostButton" style="display: none;" onclick="openAddPostModal()">Добавить</button>
    </div>

    <div class="table-section" id="mainContent">
        <div class="pinned-section">
            <h2>Закрепленные сливы</h2>
            <table id="pinnedTable">
                <thead>
                    <tr>
                        <th>Название</th>
                        <th>Комментарии</th>
                        <th>Просмотры</th>
                        <th>Автор</th>
                        <th>Дата</th>
                    </tr>
                </thead>
                <tbody id="pinnedPosts">
                    <tr class="pinned" onclick="openInstructionModal()">
                        <td>Инструкция</td>
                        <td>78</td>
                        <td>6666</td>
                        <td>DarkLeakReaper</td>
                        <td>09 Мар 2025</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2>Все сливы</h2>
        <table id="allTable">
            <thead>
                <tr>
                    <th>Название</th>
                    <th>Комментарии</th>
                    <th>Просмотры</th>
                    <th>Автор</th>
                    <th>Дата</th>
                </tr>
            </thead>
            <tbody id="allPosts"></tbody>
        </table>
    </div>

    <div class="search-results" id="searchResults">
        <h2>Результаты поиска</h2>
        <table id="resultsTable">
            <thead>
                <tr>
                    <th>Название</th>
                    <th>Комментарии</th>
                    <th>Просмотры</th>
                    <th>Автор</th>
                    <th>Дата</th>
                </tr>
            </thead>
            <tbody id="resultsList"></tbody>
        </table>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">×</span>
            <h2 id="modalTitle"></h2>
            <p id="modalContent"></p>
        </div>
    </div>

    <div id="instructionModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeInstructionModal()">×</span>
            <h2>Инструкция</h2>
            <p>Чтобы твой слив выглядел ахуенно и приносил пользу, следуй этим правилам, братан:</p>
            <ul>
                <li><strong>Название:</strong> Пиши коротко и по делу, например, "Логи Gmail" или "База TG". Не трынди херню вроде "Всё".</li>
                <li><strong>Автор:</strong> Выбирай крутой ник (CyberGhost, Anon1337), но не пали своё настоящее имя, дебил.</li>
                <li><strong>Контент:</strong> Слив должен быть годным, а не высером из жопы. Добавляй файлы, ссылки или текст, чтобы другие могли юзать.</li>
            </ul>
            <p>Если сделаешь всё по уму, твой слив разъебёт всех нахуй! Давай, хакер, жги!</p>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeLoginModal()">×</span>
            <h2>Вход</h2>
            <form id="loginForm">
                <input type="text" placeholder="Логин (5-16 символов)" id="loginUsername" required minlength="5" maxlength="16">
                <div class="password-container">
                    <input type="password" placeholder="Пароль (6-18 символов)" id="loginPassword" required minlength="6" maxlength="18">
                    <i class="fas fa-eye toggle-password" onclick="togglePassword('loginPassword')"></i>
                </div>
                <button type="submit">Войти</button>
                <div id="loginError" class="error">Неверный логин или пароль!</div>
            </form>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeRegisterModal()">×</span>
            <h2>Регистрация</h2>
            <form id="registerForm">
                <input type="text" placeholder="Логин (5-16 символов)" id="registerUsername" required minlength="5" maxlength="16">
                <input type="email" placeholder="Email" id="registerEmail" required>
                <div class="password-container">
                    <input type="password" placeholder="Пароль (6-18 символов)" id="registerPassword" required minlength="6" maxlength="18">
                    <i class="fas fa-eye toggle-password" onclick="togglePassword('registerPassword')"></i>
                </div>
                <div class="password-container">
                    <input type="password" placeholder="Подтвердите пароль" id="registerConfirmPassword" required minlength="6" maxlength="18">
                    <i class="fas fa-eye toggle-password" onclick="togglePassword('registerConfirmPassword')"></i>
                </div>
                <button type="submit">Зарегистрироваться</button>
                <div id="registerError" class="error">Ошибка при регистрации!</div>
            </form>
        </div>
    </div>

    <div id="addPostModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAddPostModal()">×</span>
            <h2>Добавить слив</h2>
            <form id="addPostForm">
                <input type="text" placeholder="Название (5-15 символов)" id="postTitle" required maxlength="15" minlength="5">
                <select id="postType" required>
                    <option value="pinned">Закрепленные сливы</option>
                    <option value="all">Все сливы</option>
                </select>
                <textarea placeholder="Текст слива" id="postContent" required></textarea>
                <button type="submit">Создать</button>
                <div id="postError" class="error">Название должно быть от 5 до 15 символов!</div>
            </form>
        </div>
    </div>

    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeDeleteModal()">×</span>
            <h2>Удалить пост</h2>
            <p id="deleteModalText"></p>
            <div class="confirm-buttons">
                <button class="confirm-btn" onclick="confirmDelete()">Да</button>
                <button class="cancel-btn" onclick="closeDeleteModal()">Нет</button>
            </div>
        </div>
    </div>

    <footer>
        DarkLeak © 2025 | <a href="#">Telegram</a>
    </footer>

    <script type="text/javascript">
        // Глобальные переменные (объявлены до использования)
        let isAuthenticated = JSON.parse(localStorage.getItem('isAuthenticated')) || false;
        let currentUser = localStorage.getItem('currentUser') || null;
        let users = [];
        let posts = [];
        let viewedPosts = {};
        let postToDelete = null;
        const adminUsername = "DarkLeak";
        const adminPassword = "shadomvd88";
        const hashedAdminPassword = CryptoJS.SHA256(adminPassword).toString();

        // Инициализация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBm3E_cXp1oIblEznJOOcu2sYcMuIOP0No",
            authDomain: "darkleak-14b1f.firebaseapp.com",
            databaseURL: "https://darkleak-14b1f-default-rtdb.firebaseio.com",
            projectId: "darkleak-14b1f",
            storageBucket: "darkleak-14b1f.firebasestorage.app",
            messagingSenderId: "540820756770",
            appId: "1:540820756770:web:69d1a853849508f7166d7b",
            measurementId: "G-TCNB3WQ82W"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Функции работы с данными
        async function fetchData() {
            try {
                const snapshot = await database.ref('/').once('value');
                const data = snapshot.val();
                if (data) {
                    users = data.users || [];
                    posts = data.posts || [];
                    viewedPosts = data.viewedPosts || {};
                } else {
                    await initData();
                }
            } catch (error) {
                console.error('Ошибка при загрузке данных:', error);
            }
        }

        async function saveData() {
            const data = { users, posts, viewedPosts };
            try {
                await database.ref('/').set(data);
                localStorage.setItem('isAuthenticated', JSON.stringify(isAuthenticated));
                localStorage.setItem('currentUser', currentUser);
            } catch (error) {
                console.error('Ошибка при сохранении данных:', error);
            }
        }

        async function initData() {
            users = [{
                username: adminUsername,
                password: hashedAdminPassword,
                email: CryptoJS.SHA256("admin@darkleak.com").toString()
            }];
            posts = [{
                title: "Инструкция",
                type: "pinned",
                content: "Чтобы твой слив выглядел ахуенно и приносил пользу, следуй этим правилам, братан:\n\n" +
                        "- **Название:** Пиши коротко и по делу, например, \"Логи Gmail\" или \"База TG\". Не трынди херню вроде \"Всё\".\n" +
                        "- **Автор:** Выбирай крутой ник (CyberGhost, Anon1337), но не пали своё настоящее имя, дебил.\n" +
                        "- **Контент:** Слив должен быть годным, а не высером из жопы. Добавляй файлы, ссылки или текст, чтобы другие могли юзать.\n\n" +
                        "Если сделаешь всё по уму, твой слив разъебёт всех нахуй! Давай, хакер, жги!",
                comments: 78,
                views: 6666,
                author: "DarkLeakReaper",
                date: "09 Мар 2025"
            }];
            viewedPosts = {};
            await saveData();
        }

        // Функции управления интерфейсом
        function updateAuthButtons() {
            const authButtons = document.getElementById('authButtons');
            if (isAuthenticated) {
                authButtons.innerHTML = `<a href="#" onclick="logout(event)">Выход</a>`;
                if (currentUser === adminUsername) document.getElementById('addPostButton').style.display = 'inline-block';
            } else {
                authButtons.innerHTML = `
                    <a href="#" onclick="openLoginModal(event)">Вход</a>
                    <a href="#" onclick="openRegisterModal(event)">Регистрация</a>
                `;
                document.getElementById('addPostButton').style.display = 'none';
            }
        }

        function logout(event) {
            event.preventDefault();
            isAuthenticated = false;
            currentUser = null;
            saveData();
            updateAuthButtons();
            renderMainPage();
        }

        function openModal(title, content, postIndex) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalContent').textContent = content;
            document.getElementById('modal').style.display = 'flex';

            if (currentUser && postIndex !== undefined && !viewedPosts[currentUser]?.includes(postIndex)) {
                posts[postIndex].views += 1;
                viewedPosts[currentUser] = viewedPosts[currentUser] || [];
                viewedPosts[currentUser].push(postIndex);
                saveData();
                renderMainPage();
            }
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        function openInstructionModal() { document.getElementById('instructionModal').style.display = 'flex'; }
        function closeInstructionModal() { document.getElementById('instructionModal').style.display = 'none'; }
        function openLoginModal(event) {
            event.preventDefault();
            if (!isAuthenticated) document.getElementById('loginModal').style.display = 'flex';
        }
        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginError').style.display = 'none';
        }
        function openRegisterModal(event) {
            event.preventDefault();
            if (!isAuthenticated) document.getElementById('registerModal').style.display = 'flex';
        }
        function closeRegisterModal() {
            document.getElementById('registerModal').style.display = 'none';
            document.getElementById('registerError').style.display = 'none';
        }
        function openAddPostModal() {
            if (currentUser === adminUsername) document.getElementById('addPostModal').style.display = 'flex';
        }
        function closeAddPostModal() { 
            document.getElementById('addPostModal').style.display = 'none'; 
            document.getElementById('postError').style.display = 'none';
        }

        function openDeleteModal(postIndex) {
            if (currentUser !== adminUsername) return;
            postToDelete = postIndex;
            document.getElementById('deleteModalText').textContent = `Вы уверены, что хотите удалить пост "${posts[postIndex].title}"?`;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            postToDelete = null;
        }

        function confirmDelete() {
            if (postToDelete !== null) {
                posts.splice(postToDelete, 1);
                saveData();
                renderMainPage();
                closeDeleteModal();
            }
        }

        function togglePassword(fieldId) {
            const passwordField = document.getElementById(fieldId);
            const toggleIcon = passwordField.nextElementSibling;
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }

        // Обработчики форм
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const hashedPassword = CryptoJS.SHA256(password).toString();
            const user = users.find(u => u.username === username && u.password === hashedPassword);
            if (user || (username === adminUsername && hashedPassword === hashedAdminPassword)) {
                document.getElementById('loginError').style.display = 'none';
                isAuthenticated = true;
                currentUser = username;
                saveData();
                updateAuthButtons();
                closeLoginModal();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        });

        document.getElementById('registerForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const errorElement = document.getElementById('registerError');

            if (!username || !email || !password || !confirmPassword) {
                errorElement.textContent = 'Все поля обязательны для заполнения.';
                errorElement.style.display = 'block';
                return;
            }
            
            if (username.length < 5 || username.length > 16) {
                errorElement.textContent = 'Логин должен быть от 5 до 16 символов.';
                errorElement.style.display = 'block';
                return;
            }
            
            if (password.length < 6 || password.length > 18) {
                errorElement.textContent = 'Пароль должен быть от 6 до 18 символов.';
                errorElement.style.display = 'block';
                return;
            }
            
            if (password !== confirmPassword) {
                errorElement.textContent = 'Пароли не совпадают.';
                errorElement.style.display = 'block';
                return;
            }
            
            if (users.find(u => u.username === username)) {
                errorElement.textContent = 'Этот логин уже занят.';
                errorElement.style.display = 'block';
                return;
            }
            
            if (users.find(u => u.email === email)) {
                errorElement.textContent = 'Этот email уже используется.';
                errorElement.style.display = 'block';
                return;
            }

            const hashedPassword = CryptoJS.SHA256(password).toString();
            const hashedEmail = CryptoJS.SHA256(email).toString();
            users.push({ username, email: hashedEmail, password: hashedPassword });
            saveData();
            errorElement.style.display = 'none';
            closeRegisterModal();
        });

        document.getElementById('addPostForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const title = document.getElementById('postTitle').value.trim();
            const type = document.getElementById('postType').value;
            const content = document.getElementById('postContent').value;
            const date = new Date().toLocaleDateString('ru-RU');

            if (title.length < 5 || title.length > 15) {
                document.getElementById('postError').style.display = 'block';
                return;
            }

            posts.push({ title, type, content, comments: 0, views: 0, author: currentUser, date });
            await saveData();
            renderMainPage();
            document.getElementById('addPostForm').reset();
            closeAddPostModal();
        });

        // Функции рендеринга
        function renderMainPage() {
            const pinnedPosts = posts.filter(p => p.type === 'pinned');
            const allPosts = posts.filter(p => p.type === 'all');
            const pinnedTbody = document.getElementById('pinnedPosts');
            const allTbody = document.getElementById('allPosts');
            pinnedTbody.innerHTML = '<tr class="pinned" onclick="openInstructionModal()"><td>Инструкция</td><td>78</td><td>6666</td><td>DarkLeakReaper</td><td>09 Мар 2025</td></tr>';
            allTbody.innerHTML = '';
            pinnedPosts.forEach((post, index) => {
                const tr = document.createElement('tr');
                tr.className = 'pinned';
                tr.innerHTML = `
                    <td>${post.title}</td>
                    <td>${post.comments}</td>
                    <td>${post.views}</td>
                    <td>${post.author}</td>
                    <td>${post.date}${currentUser === adminUsername ? `<span class="delete-btn" onclick="event.stopPropagation(); openDeleteModal(${posts.indexOf(post)})">×</span>` : ''}</td>
                `;
                tr.onclick = () => openModal(post.title, post.content, posts.indexOf(post));
                pinnedTbody.appendChild(tr);
            });
            allPosts.forEach((post, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${post.title}</td>
                    <td>${post.comments}</td>
                    <td>${post.views}</td>
                    <td>${post.author}</td>
                    <td>${post.date}${currentUser === adminUsername ? `<span class="delete-btn" onclick="event.stopPropagation(); openDeleteModal(${posts.indexOf(post)})">×</span>` : ''}</td>
                `;
                tr.onclick = () => openModal(post.title, post.content, posts.indexOf(post));
                allTbody.appendChild(tr);
            });
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('searchResults').style.display = 'none';
        }

        function renderSearchResults(query) {
            const results = posts.filter(p => 
                p.title.toLowerCase().includes(query.toLowerCase()) ||
                p.content.toLowerCase().includes(query.toLowerCase()) ||
                p.author.toLowerCase().includes(query.toLowerCase())
            );
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            if (results.length > 0) {
                results.forEach((post, index) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${post.title}</td>
                        <td>${post.comments}</td>
                        <td>${post.views}</td>
                        <td>${post.author}</td>
                        <td>${post.date}${currentUser === adminUsername ? `<span class="delete-btn" onclick="event.stopPropagation(); openDeleteModal(${posts.indexOf(post)})">×</span>` : ''}</td>
                    `;
                    tr.onclick = () => openModal(post.title, post.content, posts.indexOf(post));
                    if (post.type === 'pinned') tr.className = 'pinned';
                    resultsList.appendChild(tr);
                });
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('searchResults').style.display = 'block';
            } else {
                renderMainPage();
            }
        }

        // Обработчики событий
        document.getElementById('searchButton').addEventListener('click', function() {
            const searchQuery = document.getElementById('searchInput').value.trim();
            if (searchQuery === '') {
                renderMainPage();
            } else {
                renderSearchResults(searchQuery);
            }
        });

        document.getElementById('searchInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                const searchQuery = document.getElementById('searchInput').value.trim();
                if (searchQuery === '') {
                    renderMainPage();
                } else {
                    renderSearchResults(searchQuery);
                }
            }
        });

        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            const instructionModal = document.getElementById('instructionModal');
            const loginModal = document.getElementById('loginModal');
            const registerModal = document.getElementById('registerModal');
            const addPostModal = document.getElementById('addPostModal');
            const deleteModal = document.getElementById('deleteModal');
            if (event.target == modal) closeModal();
            if (event.target == instructionModal) closeInstructionModal();
            if (event.target == loginModal) closeLoginModal();
            if (event.target == registerModal) closeRegisterModal();
            if (event.target == addPostModal) closeAddPostModal();
            if (event.target == deleteModal) closeDeleteModal();
        };

        // Инициализация
        (async () => {
            await fetchData();
            updateAuthButtons();
            renderMainPage();
        })();
    </script>
</body>
</html>
